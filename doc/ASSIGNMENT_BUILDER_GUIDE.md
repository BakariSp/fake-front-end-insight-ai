# Assignment Builder 使用指南

## 📋 目录
- [功能概述](#功能概述)
- [快速开始](#快速开始)
- [主要功能](#主要功能)
- [组件架构](#组件架构)
- [使用教程](#使用教程)
- [常见问题](#常见问题)

---

## 功能概述

Assignment Builder（作业构建器）是教师端的核心功能模块，用于创建、编辑和管理作业包。基于 `task_builder.md` 的需求文档实现。

### 核心特性

✅ **拖拽式任务创建** - 从任务库拖拽或点击快速添加任务  
✅ **多种任务类型** - 支持选择题、写作题、扫描上传、音频、视频、文件上传  
✅ **智能导入** - OCR识别、AI生成、Google Form导入  
✅ **实时预览** - 学生端视角预览作业效果  
✅ **冲突检测** - 自动检测并修正低置信度和配置冲突  
✅ **灵活配置** - 多种提交方式、批改模式、重交设置  

---

## 快速开始

### 访问入口

1. **教师主页**：点击 "Create Assignment" 快速操作按钮
2. **导航菜单**：侧边栏 Class > Assignments
3. **直接访问**：`/teacher/assignments/new`

### 创建作业的基本流程

```
1. 填写基本信息（标题、科目、主题、截止时间）
   ↓
2. 从左侧任务库添加任务
   ↓
3. 配置每个任务的详细设置
   ↓
4. 预览学生端效果
   ↓
5. 保存草稿或发布作业
```

---

## 主要功能

### 1. TopBar（顶部工具栏）

**位置**：页面顶部  
**功能**：
- 📝 作业标题输入
- 📚 科目选择（语文、英语、数学等）
- 🏷️ 主题标签（可多选）
- 📅 截止时间设置
- 💯 总分显示（自动计算）
- 🔍 预览按钮
- 💾 保存草稿
- 🚀 发布作业

### 2. TaskLibrary（左侧任务库）

**位置**：页面左侧  
**任务类型**：

| 图标 | 类型 | 说明 | 默认分值 |
|------|------|------|----------|
| 📝 | 选择题 | 单选、多选、判断题 | 10分 |
| ✍️ | 写作题 | 简答、段落、作文 | 20分 |
| 📷 | 扫描上传 | 手写作业拍照上传 | 15分 |
| 🎤 | 音频录制 | 口语、朗读、发音 | 15分 |
| 🎥 | 视频录制 | 演示、讲解、实验 | 20分 |
| 📎 | 文件上传 | 文档、代码、作品 | 15分 |

**操作方式**：
- 点击任务卡片快速添加
- 拖拽任务卡片到画布区域

### 3. Canvas（中间画布）

**功能**：
- 📋 任务列表展示
- 🔢 任务排序（拖拽调整顺序）
- ✏️ 快速编辑任务标题和分值
- 🎯 选中任务查看详情
- 📁 导入任务（OCR、AI生成等）
- ⚠️ 冲突提示和修正

**任务卡片信息**：
- 任务序号
- 任务类型标识（带颜色）
- 任务标题（可编辑）
- 分值（可编辑）
- 提交方式标签
- 批改模式
- 操作菜单（复制、展开、删除）

### 4. Inspector（右侧属性编辑器）

**Tab 1: 基本信息**
- 任务标题
- 任务说明
- 分值设置
- 主题标签

**Tab 2: 提交方式**
- 文字输入 ⌨️
- 手写 ✍️
- 图片上传 📷
- 音频录制 🎤
- 视频录制 🎥
- 文件上传 📎
- 相关配置（文件数量、时长限制等）

**Tab 3: 批改设置**
- 自动批改（适用于选择题）
- AI辅助批改（AI提供建议）
- 人工批改（完全手动）
- 评分模板选择

**Tab 4: 高级选项**
- 允许重新提交
- 重交次数限制
- 迟交策略（不扣分/扣10%/扣20%）
- 可见范围（全班/小组/指定学生）

### 5. ImportDrawer（导入抽屉）

**导入方式**：

#### PDF/图片 OCR
- 上传PDF或图片文件
- 自动识别题目内容
- 生成任务卡片
- 标记低置信度项

#### 资源库
- 浏览已有题目库
- 快速复用历史题目
- （功能开发中）

#### AI 生成
- 输入主题和难度
- AI自动生成题目
- 可设置题目数量
- 支持多种题型

#### Google Form 导入
- 粘贴表单链接
- 自动解析题目
- 映射到对应任务类型
- 保留原有结构

### 6. ConflictDrawer（冲突修正抽屉）

**检测类型**：
- ❓ 低置信度（OCR识别不确定）
- ⚠️ 类型冲突（任务类型可能不匹配）
- 📝 提交方式缺失
- ❌ 答案缺失

**修正方式**：
- 🔧 自动修正 - 一键应用系统建议
- 逐条处理 - 手动确认每一项
- 忽略全部 - 保留当前配置

### 7. PreviewModal（预览模态框）

**功能**：
- 👁️ 学生端视角预览
- 📋 任务列表导航
- 📝 提交界面预览
- ⬅️➡️ 上一个/下一个任务

---

## 组件架构

```
app/teacher/assignments/
├── types.ts                    # 数据类型定义
├── mockData.ts                 # Mock数据和工具函数
├── page.tsx                    # 作业列表页
├── assignments.module.css      # 列表页样式
├── new/
│   └── page.tsx               # 新建作业页
├── [id]/
│   └── edit/
│       └── page.tsx           # 编辑作业页
└── components/
    ├── AssignmentBuilder.tsx          # 主容器组件
    ├── AssignmentBuilder.module.css
    ├── TopBar.tsx                     # 顶部工具栏
    ├── TopBar.module.css
    ├── TaskLibrary.tsx                # 任务库
    ├── TaskLibrary.module.css
    ├── Canvas.tsx                     # 画布
    ├── Canvas.module.css
    ├── TaskCard.tsx                   # 任务卡片
    ├── TaskCard.module.css
    ├── Inspector.tsx                  # 属性编辑器
    ├── Inspector.module.css
    ├── ImportDrawer.tsx               # 导入抽屉
    ├── ImportDrawer.module.css
    ├── ConflictDrawer.tsx             # 冲突修正抽屉
    ├── ConflictDrawer.module.css
    ├── PreviewModal.tsx               # 预览模态框
    └── PreviewModal.module.css
```

### 数据流

```
AssignmentBuilder (主状态管理)
    ↓
    ├─→ TopBar (作业元信息)
    ├─→ TaskLibrary (添加任务)
    ├─→ Canvas (任务列表)
    │       ↓
    │   TaskCard (单个任务)
    ├─→ Inspector (编辑选中任务)
    ├─→ ImportDrawer (批量导入)
    ├─→ ConflictDrawer (冲突处理)
    └─→ PreviewModal (预览)
```

---

## 使用教程

### 场景1：创建基础作业

1. 点击主页的 "Create Assignment" 按钮
2. 填写作业标题："第一单元练习"
3. 选择科目："数学"
4. 添加主题标签："代数"、"函数"
5. 设置截止时间：7天后
6. 从左侧点击"选择题"添加任务
7. 在右侧编辑器中：
   - 修改标题："选择题 1-5"
   - 设置分值：10分
   - 选择提交方式：文字输入
   - 批改模式：自动批改
8. 点击"预览"查看学生端效果
9. 点击"发布作业"完成

### 场景2：使用OCR导入作业

1. 进入作业构建器
2. 点击画布顶部的"导入"按钮
3. 选择 "PDF/图片 OCR"
4. 上传试卷扫描件
5. 等待系统识别（显示进度条）
6. 识别完成后，任务自动添加到画布
7. 点击顶部的"⚠️ X个问题"查看冲突
8. 在冲突抽屉中点击"自动修正"
9. 手动检查修正结果
10. 保存或发布作业

### 场景3：设置差异化作业

1. 创建作业并添加基础任务
2. 添加一个进阶任务（例如：写作题）
3. 点击该任务，在右侧Inspector选择"高级选项"
4. 可见范围选择："指定学生"
5. （实际应用中可选择特定学生ID）
6. 保存设置
7. 该任务只对选定学生可见

### 场景4：使用AI生成题目

1. 点击"导入" → "AI 生成"
2. 输入主题："函数的定义域和值域"
3. 选择难度："中等"
4. 设置题目数量：5
5. 点击"开始生成"
6. 等待AI生成（显示进度）
7. 生成的任务自动添加到画布
8. 可以继续编辑或调整

---

## 常见问题

### Q: 如何调整任务顺序？
**A**: 在画布中，点击任务卡片左侧的"⋮⋮"拖拽手柄，上下拖动即可调整顺序。

### Q: 可以批量设置任务吗？
**A**: 当前版本不支持批量选择，需要逐个设置。批量操作功能已在规划中。

### Q: OCR识别错误怎么办？
**A**: 
1. 在冲突抽屉中查看低置信度项
2. 点击"修正"按钮手动编辑
3. 或者点击任务卡片，在Inspector中修改

### Q: 任务类型可以更改吗？
**A**: 创建后任务类型不可更改。如需更改，请删除原任务并重新创建。

### Q: 如何复制已有作业？
**A**: 在作业列表页，找到目标作业，点击"复制"按钮（功能开发中）。

### Q: 草稿会自动保存吗？
**A**: 当前版本不支持自动保存，请手动点击"保存草稿"按钮。

### Q: 发布后还能修改吗？
**A**: 发布后会生成新版本，已提交的学生维持旧版本，未提交的学生看到新版本。

### Q: 支持哪些科目？
**A**: 支持语文、英语、数学、物理、化学、生物、生命科学及其他科目。

### Q: 音频/视频时长有限制吗？
**A**: 默认限制300秒（5分钟），可在Inspector的"提交方式"中自定义，最长3600秒（1小时）。

### Q: 如何设置评分标准？
**A**: 在Inspector的"批改设置"中，选择评分模板（Rubric），系统提供语文、英语、数学等学科的预设模板。

---

## 技术细节

### Mock数据说明
所有数据均为静态Mock，不涉及真实API调用。实际应用中需要：
- 对接后端API
- 实现文件上传
- 接入OCR服务
- 接入AI生成服务
- 实现真实的权限控制

### 状态管理
使用React的`useState`和`useCallback`进行本地状态管理，复杂应用建议引入状态管理库（如Zustand或Redux）。

### 性能优化建议
- 大量任务时使用虚拟列表
- 图片/文件上传使用分片上传
- OCR处理使用WebWorker
- 添加防抖/节流

---

## 更新日志

### v1.0.0 (2025-11-10)
- ✅ 初始版本发布
- ✅ 完整的任务构建器UI
- ✅ 6种任务类型支持
- ✅ OCR/AI导入功能（UI）
- ✅ 学生端预览
- ✅ 冲突检测与修正

---

## 相关文档

- [task_builder.md](./task_builder.md) - 原始需求文档
- [COMPONENTS_GUIDE.md](./COMPONENTS_GUIDE.md) - 组件库使用指南
- [DESIGN_SYSTEM.md](./DESIGN_SYSTEM.md) - 设计系统规范

---

**最后更新**: 2025-11-10  
**维护者**: AI Assistant  
**项目类型**: Mock & Static Pages

