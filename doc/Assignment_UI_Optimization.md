# 作业创建界面 UI/UX 优化文档

## 优化概述

本次优化主要解决了教师端创建作业时的两个核心用户体验问题：

### 问题 1: 全局设置与题目设置混在同一层级
**问题描述**: 批改模式设置是针对整个作业的全局设置，但之前与每道题的"基本信息"、"提交方式"等放在同一层级，导致层级混乱。

**解决方案**:
- ✅ 将批改模式从任务级设置提升为全局设置
- ✅ 创建独立的"全局设置"面板，包含批改模式、评分模板、迟交策略等
- ✅ 在任务列表区域添加醒目的"⚙️ 全局设置"按钮
- ✅ 保留任务级的个性化配置能力（可选）

### 问题 2: 点击任务卡片无法正确选中和切换
**问题描述**: 点击不同题目时，右侧属性面板不会切换到对应题目，始终停留在最后添加的题目上。

**解决方案**:
- ✅ 修复 TaskCard 的点击事件处理
- ✅ 添加选中状态的视觉反馈（蓝色边框和阴影）
- ✅ 确保点击不同任务卡片时正确切换 Inspector 内容

### 问题 3: 主题标签不支持自定义
**问题描述**: 主题标签只能从预设列表中选择，无法添加、修改或删除自定义标签。

**解决方案**:
- ✅ 重新设计标签选择器，支持完全自定义
- ✅ 添加标签输入框，支持手动输入和回车确认
- ✅ 已选择标签显示为可交互的标签卡片，支持删除
- ✅ 保留预设标签快速选择功能
- ✅ 美化标签样式，使用渐变色背景

---

## 技术实现

### 1. 数据模型调整

#### AssignmentPackage 类型扩展
```typescript
export interface AssignmentPackage {
  // ... 现有字段
  // 新增全局设置
  gradingMode: GradingMode;        // 全局批改模式
  rubricId?: string;               // 全局评分模板
  allowLateSubmission?: boolean;   // 是否允许迟交
  latePolicy?: LatePolicy;         // 迟交策略
}
```

#### Task 类型调整
```typescript
export interface Task {
  // ... 现有字段
  // gradingMode 改为可选，不设置则使用全局配置
  gradingMode?: GradingMode;
  // 移除了 latePolicy（改为全局设置）
}
```

### 2. 新增组件

#### GlobalSettings 组件
- **路径**: `app/teacher/assignments/components/GlobalSettings.tsx`
- **功能**: 
  - 全局批改模式选择（自动批改、AI辅助、人工批改）
  - 评分模板选择（针对AI辅助模式）
  - 提交设置（允许迟交、迟交扣分策略）
- **UI特点**:
  - 模态弹窗设计，不干扰主界面
  - 卡片式批改模式选择，带图标和说明
  - 清晰的区块分组和视觉层级

### 3. 组件优化

#### Inspector 组件
**移除的 Tab**: 
- ❌ "批改设置" tab（移至全局设置）

**保留的 Tab**:
- ✅ 基本信息：题目、说明、分值、主题标签
- ✅ 提交方式：文字、手写、图片、音频、视频、文件
- ✅ 高级选项：重新提交、可见范围

**主题标签优化**:
- 新增输入框支持自定义标签
- 已选标签展示为可删除的标签卡片
- 保留预设标签快速选择功能
- 支持键盘回车快速添加

#### TaskCard 组件
**视觉反馈**:
- 选中状态：2px 蓝色边框 + 蓝色阴影
- 鼠标悬停：阴影加深
- 点击区域：整个卡片可点击

#### Canvas 组件
**新增按钮**:
- "⚙️ 全局设置" 按钮（渐变紫色背景，醒目）
- 位置：任务列表头部右侧

---

## UI/UX 改进亮点

### 1. 清晰的信息层级
```
作业包（全局）
├── 全局设置 ⚙️
│   ├── 批改模式（应用到所有题目）
│   ├── 评分模板
│   └── 提交规则
│
└── 任务列表
    ├── 任务 1
    │   ├── 基本信息（针对此题）
    │   ├── 提交方式（针对此题）
    │   └── 高级选项（针对此题）
    ├── 任务 2
    └── ...
```

### 2. 视觉设计增强
- **全局设置按钮**: 渐变紫色背景，与常规按钮区分
- **选中状态**: 蓝色边框和柔和阴影，清晰的视觉反馈
- **标签系统**: 渐变色标签卡片，现代美观
- **布局优化**: 更好的留白和分组

### 3. 交互体验提升
- **一键访问**: 全局设置一键打开，模态设计不干扰工作流
- **即时反馈**: 点击任务卡片立即切换属性面板
- **快速操作**: 标签回车添加，预设标签一键选择
- **防误操作**: 删除标签需点击 × 按钮

---

## 用户操作流程

### 设置全局批改模式
1. 点击任务列表头部的 "⚙️ 全局设置" 按钮
2. 在弹窗中选择批改模式（自动/AI辅助/人工）
3. 如选择 AI辅助，可选择评分模板
4. 设置是否允许迟交及扣分策略
5. 点击"确定"保存

### 编辑任务属性
1. 在任务列表中点击任务卡片（会显示蓝色选中边框）
2. 右侧属性面板自动切换到该任务
3. 在"基本信息"中编辑题目、分值等
4. 在"提交方式"中选择学生提交方式
5. 在"高级选项"中设置重交等个性化配置

### 管理主题标签
1. 在"基本信息"tab 中找到"主题标签"区域
2. **添加自定义标签**: 在输入框输入标签名，按回车或点击"添加"
3. **快速选择预设标签**: 点击"快速选择"区域的任意预设标签
4. **删除标签**: 点击已选标签卡片上的 × 按钮
5. 标签会实时更新，无需额外保存操作

---

## 文件变更清单

### 新增文件
- `app/teacher/assignments/components/GlobalSettings.tsx` - 全局设置组件
- `app/teacher/assignments/components/GlobalSettings.module.css` - 样式文件

### 修改文件
- `app/teacher/assignments/types.ts` - 数据模型更新
- `app/teacher/assignments/mockData.ts` - 默认数据调整
- `app/teacher/assignments/components/AssignmentBuilder.tsx` - 集成全局设置
- `app/teacher/assignments/components/Canvas.tsx` - 添加全局设置按钮
- `app/teacher/assignments/components/Canvas.module.css` - 样式更新
- `app/teacher/assignments/components/TaskCard.tsx` - 选中状态处理
- `app/teacher/assignments/components/TaskCard.module.css` - 选中样式
- `app/teacher/assignments/components/Inspector.tsx` - 移除批改设置tab，优化标签管理
- `app/teacher/assignments/components/Inspector.module.css` - 标签系统样式

---

## 后续优化建议

1. **全局设置提示**
   - 首次使用时显示引导提示，说明全局设置的作用范围

2. **标签管理增强**
   - 支持标签颜色自定义
   - 标签分类和标签库管理
   - 常用标签收藏功能

3. **批量操作**
   - 支持批量修改多个任务的某些属性
   - 复制一个任务的配置到其他任务

4. **智能推荐**
   - 根据科目和题型推荐合适的批改模式
   - 根据历史使用推荐常用标签

5. **撤销/重做**
   - 添加操作历史记录
   - 支持 Ctrl+Z 撤销操作

---

## 总结

本次优化从用户反馈出发，解决了信息层级混乱和交互体验不佳的核心问题。通过将全局设置与任务设置分离，并优化任务选择交互，显著提升了创建作业的效率和体验。同时，全新的标签管理系统为教师提供了更大的灵活性。

**核心价值**:
- 🎯 **层级清晰**: 全局设置与任务设置分离，职责明确
- 🖱️ **交互顺畅**: 点击任务立即切换，选中状态清晰
- 🏷️ **灵活自定义**: 标签系统支持完全自定义，满足个性化需求
- 🎨 **视觉美观**: 现代化设计语言，渐变色和动效提升品质感

